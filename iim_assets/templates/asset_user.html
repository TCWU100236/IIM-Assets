{% extends "base.html" %}
{% block title %}成大工資管財產管理系統{% endblock %}
{% block content %}
    <script>
        function editUser(userid, username) {
            // 切換為編輯模式
            document.getElementById("form-mode").value = "edit";
            document.getElementById("original-userid").value = userid;

            // 將值放到表單欄位
            document.getElementById("form-userid").value = userid;
            document.getElementById("form-username").value = username;

            // 改變按鈕文字
            document.getElementById("submit-btn").value = "儲存修改";
            document.getElementById("reset-btn").style.display = "none";
            document.getElementById("cancel-btn").style.display = "inline-block";
        }

        function resetForm() {
            document.getElementById("form-mode").value = "create";
            document.getElementById("original-userid").value = "";
            document.getElementById("form-userid").readOnly = false;
            document.getElementById("submit-btn").value = "新增財產使用者";
            document.getElementById("cancel-btn").style.display = "none";
        }

        function cancelEdit() {
            window.location.href = "/asset_user/";
        }

        function confirmDelete(userid, username) {
            if (confirm("確定要刪除財產使用者：" + username + " 嗎？")) {
                window.location.href = "/delete_asset_user/" + userid + "/";
            }
        }
    </script>
    <div class="container">
        {% for message in messages %}
            <div class="alert alert-{{message.tags}}">{{ message }}</div>
        {% endfor %}

        <div class="row" style="text-align: center;">
            <form name="asset user inserting form" action="." method="POST">
                {% csrf_token %}
                <!-- 用來區分新增還是編輯 -->
                <input type="hidden" name="mode" id="form-mode" value="create">
                <input type="hidden" name="original_userid" id="original-userid">

                <table style="margin: auto;">
                    <tr>
                        <td>使用者編號:</td>
                        <td><input type="text" name="userid" id="form-userid" required></td>
                    </tr>
                    <tr>
                        <td>使用者名稱:</td>
                        <td><input type="text" name="username" id="form-username" required></td>
                    </tr>
                </table>
                <input type="submit" id="submit-btn" value="新增財產使用者">
                <input type="reset"  id="reset-btn" value="清除重填" onclick="resetForm()">
                <input type="button" id="cancel-btn" value="取消" onclick="cancelEdit()" style="display: none;">
            </form>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" align="center">
                        <h3>~~系統現有財產使用者~~</h3>
                    </div>
                    <div class="card-body">
                        {% for user in page_obj %}
                            {% if forloop.first %}
                            <table class="table table-striped table-hover table-sm table-responsive" style="width: 80%; margin: 10px auto; padding: 10px;">
                                <tr>
                                    <td>使用者編號</td>
                                    <td>使用者名稱</td>
                                    <td>管理</td>
                                </tr>
                            {% endif %}
                                <tr>
                                    <td>{{ user.userid }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="editUser('{{ user.userid }}', '{{ user.username }}')">編輯</button>
                                        <button type="button" class="btn btn-sm btn-outline-warning" onclick="confirmDelete('{{ user.id }}', '{{ user.username }}')">刪除</button>
                                    </td>
                                </tr>
                            {% if forloop.last %}
                            </table>
                            {% endif %}
                            {% empty %}
                                <h3 class="text-center">目前沒有任何財產使用者</h3>
                        {% endfor %}
                    </div>
                    <div class='card-footer'>
                        <nav>
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">上一頁</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">上一頁</span>
                                    </li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                    {% else %}
                                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">下一頁</a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">下一頁</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>        
    </div>
{% endblock %}